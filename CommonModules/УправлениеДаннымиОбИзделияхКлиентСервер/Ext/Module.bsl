////////////////////////////////////////////////////////////////////////////////
// НСИ производства: Процедуры подсистемы управления данными об изделиях
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область Спецификации

// Возвращает параметры выбора спецификаций для номенклатуры.
// 
// Возвращаемое значение:
// 	Структура - из:
//  * ДоступныеТипы - Массив - доступные типы спецификаций
//  * ДоступныеСтатусы - Массив - доступные статусы спецификаций
//  * ДоступныСпецификацииСПроизводствомНаСтороне - Булево - признак доступности спецификаций с производством на стороне
//  * ДоступныСпецификацииНаПобочныйВыход - Булево - признак отображения спецификаций по фиксированной стоимости
//  * ПолучитьСпецификацииПоНоменклатуре - Булево - признак отбора по заданной номенклатуре
//  * СвязиПараметровВыбора - Соответствие - связи параметров выбора
//  * РеквизитыСпецификации - Строка - список реквизитов спецификации
//
Функция ПараметрыВыбораСпецификаций() Экспорт
	
	ПараметрыВыбора = Новый Структура;
	
	ПараметрыВыбора.Вставить("ДоступныеТипы", Новый Массив);
	ПараметрыВыбора.Вставить("ДоступныеСтатусы", Новый Массив);
	
	ПараметрыВыбора.Вставить("ДоступныСпецификацииСПроизводствомНаСтороне", Истина);
	
	ПараметрыВыбора.Вставить("ДоступныСпецификацииНаПобочныйВыход", Ложь);
	
	ПараметрыВыбора.Вставить("ПолучитьСпецификацииПоНоменклатуре", Истина);
	
	ПараметрыВыбора.Вставить("СвязиПараметровВыбора", Новый Соответствие);
	
	// Для получения реквизитов подбираемой спецификации
	ПараметрыВыбора.Вставить("РеквизитыСпецификации", "");
	
	Возврат ПараметрыВыбора;
	
КонецФункции

// Возвращает параметры необходимые для выполнения действия "ПроверитьЗаполнитьСпецификацию".
//
// Параметры:
//  Объект							- ДанныеФормыСтруктура 			- Текущий объект
//  ТекущиеДанные					- ДанныеФормыЭлементКоллекции 	- Строка коллекции в которой происходит выбор спецификации
//  ПараметрыВыбораСпецификаций		- Структура 					- Параметры выбора спецификации
//  Форма							- ФормаКлиентскогоПриложения				- форма
//  ДополнительныеПараметры			- Структура 					- Дополнительные параметры вызова
// 
// Возвращаемое значение:
//  Структура - список параметров.
//
Функция ПараметрыДействияПроверитьЗаполнитьСпецификацию(Объект,
	ТекущиеДанные,
	ПараметрыВыбораСпецификаций,
	Форма = Неопределено,
	ДополнительныеПараметры = Неопределено) Экспорт
	
	ПараметрыДействия = Новый Структура("ДанныеОбИзделии,ПараметрыВыбораСпецификаций,ИмяПоляСпецификация");
	
	ПараметрыДействия.ПараметрыВыбораСпецификаций = ПараметрыВыбораСпецификаций;
	ПараметрыДействия.ИмяПоляСпецификация         = "Спецификация";
	
	Если ТипЗнч(ДополнительныеПараметры) = Тип("Структура") И ДополнительныеПараметры.Свойство("ИмяРеквизитаСпецификация") Тогда
		ПараметрыДействия.ИмяПоляСпецификация = ДополнительныеПараметры.ИмяРеквизитаСпецификация;
	КонецЕсли;
	
	ПараметрыДействия.ДанныеОбИзделии = СобратьДанныеОбИзделииДляВыбораСпецификации(
		Объект,
		ТекущиеДанные,
		ПараметрыВыбораСпецификаций,
		Форма,
		ДополнительныеПараметры);
	ПараметрыДействия.ДанныеОбИзделии.ТекущаяСпецификация = ТекущиеДанные[ПараметрыДействия.ИмяПоляСпецификация];
	
	Возврат ПараметрыДействия;
	
КонецФункции

// Установить параметры выбора спецификаций в форме
//
// Параметры:
//  Элемент						 - ПолеФормы, Массив - поле ввода спецификации или список полей
//  ПараметрыВыбораСпецификаций	 - см. ПараметрыВыбораСпецификаций
//
Процедура УстановитьПараметрыВыбораСпецификаций(Элемент, ПараметрыВыбораСпецификаций) Экспорт
	
	ПараметрыВыбора = Новый Массив();
	
	Для каждого ЗначениеПараметра Из ПараметрыВыбораСпецификаций Цикл
		Если ЗначениеПараметра.Ключ = "СвязиПараметровВыбора" Тогда
			Продолжить;
		КонецЕсли;
		НовыйПараметр = Новый ПараметрВыбора(ЗначениеПараметра.Ключ, ЗначениеПараметра.Значение);
		ПараметрыВыбора.Добавить(НовыйПараметр);
	КонецЦикла;
	
	Если ПараметрыВыбораСпецификаций.Свойство("ДоступныеТипы") И ПараметрыВыбораСпецификаций.ДоступныеТипы.Количество() <> 0 Тогда
		НовыйПараметр = Новый ПараметрВыбора("Отбор.ТипПроизводственногоПроцесса", Новый ФиксированныйМассив(ПараметрыВыбораСпецификаций.ДоступныеТипы));
		ПараметрыВыбора.Добавить(НовыйПараметр);
	КонецЕсли;
	
	Если ПараметрыВыбораСпецификаций.Свойство("ДоступныеСтатусы") И ПараметрыВыбораСпецификаций.ДоступныеСтатусы.Количество() <> 0 Тогда
		НовыйПараметр = Новый ПараметрВыбора("Отбор.Статус", Новый ФиксированныйМассив(ПараметрыВыбораСпецификаций.ДоступныеСтатусы));
		ПараметрыВыбора.Добавить(НовыйПараметр);
	КонецЕсли;
	
	ФормаВыбора = "Справочник.РесурсныеСпецификации.Форма.ФормаВыбораПоНоменклатуре";
	
	Если ТипЗнч(Элемент) = Тип("Массив") Тогда
		МассивЭлементов = Элемент;
	Иначе
		МассивЭлементов = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Элемент);
	КонецЕсли;
	
	ПутиСвязейПараметровВыбораЭлементов = ПараметрыВыбораСпецификаций.СвязиПараметровВыбора;
	Для каждого ТекущийЭлемент Из МассивЭлементов Цикл
		
		ТекущийЭлемент.ПараметрыВыбора = Новый ФиксированныйМассив(ПараметрыВыбора);
		
		ПутиСвязейПараметровВыбораЭлемента = ПутиСвязейПараметровВыбораЭлементов.Получить(ТекущийЭлемент.ПутьКДанным);
		Если ПутиСвязейПараметровВыбораЭлемента = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		ТаблицаФормы    = Неопределено;
		ТекущийРодитель = ТекущийЭлемент.Родитель;
		Пока ТипЗнч(ТекущийРодитель) <> Тип("ФормаКлиентскогоПриложения") Цикл
			Если ТипЗнч(ТекущийРодитель) = Тип("ТаблицаФормы") Тогда
				ТаблицаФормы = ТекущийРодитель;
				Прервать;
			КонецЕсли;
			ТекущийРодитель = ТекущийРодитель.Родитель;
		КонецЦикла;
		
		Если ТаблицаФормы = Неопределено И СтрНайти(ТекущийЭлемент.ПутьКДанным, ".ТекущиеДанные.") > 0 Тогда
			ЧастиПути = СтрРазделить(ТекущийЭлемент.ПутьКДанным,".");
			Если ЧастиПути.Количество() = 4 Тогда
				ТаблицаФормы = ТекущийРодитель["Элементы"].Найти(ЧастиПути[1]);
			КонецЕсли;
		КонецЕсли;
		
		СвязиПараметровВыбора = Новый Массив();
		Для каждого КлючИЗначение Из ПутиСвязейПараметровВыбораЭлемента Цикл
			
			Если НЕ ЗначениеЗаполнено(КлючИЗначение.Значение) Тогда
				Продолжить;
			КонецЕсли;
			
			Если ТипЗнч(КлючИЗначение.Значение) = Тип("Структура") Тогда
				ПутьКДанным    = КлючИЗначение.Значение.ПутьКДанным;
				РежимИзменения = КлючИЗначение.Значение.РежимИзменения;
			Иначе
				ПутьКДанным    = КлючИЗначение.Значение;
				РежимИзменения = РежимИзмененияСвязанногоЗначения.НеИзменять;
			КонецЕсли;
			
			Если ТаблицаФормы <> Неопределено И СтрНайти(ПутьКДанным, ТаблицаФормы.ПутьКДанным+".") > 0 Тогда
				ПутьКДанным = СтрШаблон("Элементы.%1.ТекущиеДанные.%2",
					ТаблицаФормы.Имя,
					Сред(ПутьКДанным,СтрНайти(ПутьКДанным,".", НаправлениеПоиска.СКонца)+1));
			КонецЕсли;
				
			СвязиПараметровВыбора.Добавить(Новый СвязьПараметраВыбора(КлючИЗначение.Ключ, ПутьКДанным, РежимИзменения));
			Если КлючИЗначение.Ключ = "Номенклатура"
					ИЛИ КлючИЗначение.Ключ = "Характеристика" Тогда
				СвязиПараметровВыбора.Добавить(Новый СвязьПараметраВыбора("Отбор."+КлючИЗначение.Ключ, ПутьКДанным, РежимИзменения));
			КонецЕсли;
			
		КонецЦикла;
		ТекущийЭлемент.СвязиПараметровВыбора = Новый ФиксированныйМассив(СвязиПараметровВыбора);
		
		ТекущийЭлемент.ФормаВыбора = ФормаВыбора;
		
	КонецЦикла;
	
КонецПроцедуры

// Процедура устанавливает параметры выбора для номенклатуры.
//
// Параметры:
//  Элемент - Массив, ПолеФормы - поле для ввода номенклатуры
//  Форма - ФормаКлиентскогоПриложения - форма для которой производится установка параметров выбора:
//  	* Объект  - ДанныеФормыСтруктура - объект, для которого производится установка параметров выбора:
//  		* ТипПроизводственногоПроцесса - ПеречислениеСсылка.ТипыПроизводственныхПроцессов
//  		* Ссылка - СправочникСсылка.РесурсныеСпецификации,ДокументСсылка.ЗаказНаПроизводство2_2
//  	* ИсточникСоставаНаборовВПроизводстве - ПеречислениеСсылка.ИсточникиСоставаНаборовВПроизводстве
//
Процедура УстановитьПараметрыВыбораНоменклатуры(Элемент, Форма) Экспорт
	
	МассивПараметровВыбора = Новый Массив;
	МассивТипов = Новый Массив;
	МассивТипов.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.Товар"));
	
	Объект = Форма.Объект;
	ТипПроизводственногоПроцесса = Объект.ТипПроизводственногоПроцесса;
	
	Если ТипПроизводственногоПроцесса = ПредопределенноеЗначение("Перечисление.ТипыПроизводственныхПроцессов.Сборка")
		ИЛИ ТипПроизводственногоПроцесса = ПредопределенноеЗначение("Перечисление.ТипыПроизводственныхПроцессов.БезСпецификаций") Тогда
		
		МассивТипов.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.МногооборотнаяТара"));
		МассивТипов.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.Работа"));
		
		
	КонецЕсли;
	
	МассивПараметровВыбора.Добавить(Новый ПараметрВыбора("Отбор.ТипНоменклатуры", Новый ФиксированныйМассив(МассивТипов)));
	
	Если ТипЗнч(Элемент) = Тип("Массив") Тогда
		Элементы = Элемент;
	Иначе
		Элементы = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Элемент);
	КонецЕсли;
	
	Для Индекс = 0 По Элементы.ВГраница() Цикл
		Элементы[Индекс].ПараметрыВыбора = Новый ФиксированныйМассив(МассивПараметровВыбора);
	КонецЦикла;
	
КонецПроцедуры

// Перечень полей, определяющих выбор спецификации номенклатуры
// 
// Возвращаемое значение:
//  Строка - перечень полей
//
Функция ПоляСтруктурыДанныхОбИзделииДляВыбораСпецификации() Экспорт
	
	Возврат "Номенклатура,Характеристика,НачалоПроизводства,ПодразделениеДиспетчер,НаправлениеДеятельности";
	
КонецФункции

// Конструктор структуры данных для выбора спецификации номенклатуры
// 
// Возвращаемое значение:
//  Структура - структура данных
//
Функция СтруктураДанныхОбИзделииДляВыбораСпецификации() Экспорт
	
	Результат = Новый Структура(ПоляСтруктурыДанныхОбИзделииДляВыбораСпецификации());
	
	Результат.Номенклатура            = ПредопределенноеЗначение("Справочник.Номенклатура.ПустаяСсылка");
	Результат.Характеристика          = ПредопределенноеЗначение("Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка");
	Результат.НачалоПроизводства      = Дата(1,1,1);
	Результат.ПодразделениеДиспетчер  = ПредопределенноеЗначение("Справочник.СтруктураПредприятия.ПустаяСсылка");
	Результат.НаправлениеДеятельности = ПредопределенноеЗначение("Справочник.НаправленияДеятельности.ПустаяСсылка");
	
	Результат.Вставить("ТекущаяСпецификация", ПредопределенноеЗначение("Справочник.РесурсныеСпецификации.ПустаяСсылка"));
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#Область РасчетПоФормулам

// Возвращает описание функций используемых в конструкторе формул
// 
// Параметры:
//  ИмяГруппы - Строка - имя группы в дереве формул конструктора
// 
// Возвращаемое значение:
//  Массив из см. РаботаСФормуламиКлиентСервер.ОписаниеФункцииОбщегоМодуля - описание функций внешних модулей.
//
Функция ОписаниеФункцийКонструктораФормул(ИмяГруппы = "") Экспорт
	
	Результат = РаботаСФормуламиКлиентСервер.ФункцииОбщегоМодуля();
	
	Если ИмяГруппы = "ЧисловыеФункции" ИЛИ ПустаяСтрока(ИмяГруппы) Тогда
		
		Описание = ОписаниеФункцииКонструктораФормулОкрВверх();
		Результат.Добавить(Описание);
		
		Описание = ОписаниеФункцииКонструктораФормулОкрВниз();
		Результат.Добавить(Описание);
		
	КонецЕсли;
	
	Если ИмяГруппы = "ПрочиеФункции" ИЛИ ПустаяСтрока(ИмяГруппы) Тогда
	
		Описание = РаботаСФормуламиКлиентСервер.ОписаниеФункцииОбщегоМодуля();
		Описание.Идентификатор = "ВыборПоПорогу";
		Описание.ПолныйПуть = "УправлениеДаннымиОбИзделияхКлиентСервер.ВыборПоПорогу";
		Описание.Представление = НСтр("ru = 'Выбор по порогу'");
		ПредставлениеПараметра1 = НСтр("ru = '<Параметр>'");
		ПредставлениеПараметра2 = НСтр("ru = '<Значение1>'");
		ПредставлениеПараметра3 = НСтр("ru = '<Порог1>'");
		ПредставлениеПараметра4 = НСтр("ru = '<Значение2>'");
		ПредставлениеПараметра5 = НСтр("ru = '<Порог4 (необязательный)>'");
		ПредставлениеПараметра6 = НСтр("ru = '<Значение5 (необязательный)>'");
		Описание.КонструкцияДляВставки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			"ВыборПоПорогу(%1, %2, %3, %4,..., %5, %6)",
			ПредставлениеПараметра1,
			ПредставлениеПараметра2,
			ПредставлениеПараметра3,
			ПредставлениеПараметра4,
			ПредставлениеПараметра5,
			ПредставлениеПараметра6);
		Описание.Пояснение = НСтр("ru = 'Выбирает значение согласно заданному порогу'");
		Результат.Добавить(Описание);
	
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Возвращает описание функции ОкрВверх для конструктора формул
// 
// Возвращаемое значение:
//  см. РаботаСФормуламиКлиентСервер.ОписаниеФункцииОбщегоМодуля
//
Функция ОписаниеФункцииКонструктораФормулОкрВверх() Экспорт
	
	Описание = РаботаСФормуламиКлиентСервер.ОписаниеФункцииОбщегоМодуля();
	Описание.Идентификатор = "ОкрВверх";
	Описание.ПолныйПуть = "ОбщегоНазначенияУТКлиентСервер.ОкрВверх";
	Описание.Представление = НСтр("ru = 'Округление вверх'");
	ПредставлениеПараметра1 = НСтр("ru = '<Округляемое значение>'");
	ПредставлениеПараметра2 = НСтр("ru = '<Разрядность>'");
	Описание.КонструкцияДляВставки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
		"ОкрВверх(%1, %2)",
		ПредставлениеПараметра1,
		ПредставлениеПараметра2);
	Описание.Пояснение = НСтр("ru = 'Округление до ближайшего большего значения'");
	
	Возврат Описание;
	
КонецФункции

// Возвращает описание функции ОкрВниз для конструктора формул
// 
// Возвращаемое значение:
//  см. РаботаСФормуламиКлиентСервер.ОписаниеФункцииОбщегоМодуля
//
Функция ОписаниеФункцииКонструктораФормулОкрВниз() Экспорт
	
	Описание = РаботаСФормуламиКлиентСервер.ОписаниеФункцииОбщегоМодуля();
	Описание.Идентификатор = "ОкрВниз";
	Описание.ПолныйПуть = "ОбщегоНазначенияУТКлиентСервер.ОкрВниз";
	Описание.Представление = НСтр("ru = 'Округление вниз'");
	ПредставлениеПараметра1 = НСтр("ru = '<Округляемое значение>'");
	ПредставлениеПараметра2 = НСтр("ru = '<Разрядность>'");
	Описание.КонструкцияДляВставки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
		"ОкрВниз(%1, %2)",
		ПредставлениеПараметра1,
		ПредставлениеПараметра2);
	Описание.Пояснение = НСтр("ru = 'Округление до ближайшего меньшего значения'");
	
	Возврат Описание;
	
КонецФункции

// Выбирает значение согласно заданному порогу
//
// Параметры:
//  Параметр	 - Число	 - параметр
//  Значение	 - Число	 - значение
//  Порог		 - Число	 - порог
//  Значение2	 - Число	 - значение
//  Порог2		 - Число	 - порог
//  Значение3	 - Число	 - значение
//  Порог3		 - Число	 - порог
//  Значение4	 - Число	 - значение
//  Порог4		 - Число	 - порог
//  Значение5	 - Число	 - значение
//  Порог5		 - Число	 - порог
// 
// Возвращаемое значение:
//  Число - результат выбора
//
Функция ВыборПоПорогу(
	Параметр,
	Значение,
	Порог,
	Значение2 = 0,
	Порог2 = Неопределено,
	Значение3 = 0,
	Порог3 = Неопределено,
	Значение4 = 0,
	Порог4 = Неопределено,
	Значение5 = 0,
	Порог5 = Неопределено) Экспорт
	
	Результат = 0;
	
	Если Порог >= Параметр Тогда 
		
		Результат = Значение;
		
	ИначеЕсли Значение2 <> 0 И Порог2 = Неопределено Тогда
		
		Результат = Значение2;
		
	ИначеЕсли ЗначениеЗаполнено(Порог2) И Значение2 <> Неопределено И Порог2 >= Параметр Тогда
		
		Результат = Значение2;
		
	ИначеЕсли Значение3 <> 0 И Порог3 = Неопределено Тогда
		
		Результат = Значение3;
		
	ИначеЕсли ЗначениеЗаполнено(Порог3) И Значение3 <> Неопределено И Порог3 >= Параметр Тогда
		
		Результат = Значение3;
		
	ИначеЕсли Значение4 <> 0 И Порог4 = Неопределено Тогда
		
		Результат = Значение4;
	
	ИначеЕсли ЗначениеЗаполнено(Порог4) И Значение4 <> Неопределено И Порог4 >= Параметр Тогда
		
		Результат = Значение4;
		
	ИначеЕсли Значение5 <> 0 И Порог5 = Неопределено Тогда
		
		Результат = Значение5;
		
	ИначеЕсли ЗначениеЗаполнено(Порог5) И Значение5 <> Неопределено И Порог5 >= Параметр Тогда
		
		Результат = Значение5;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#Область РедактированиеМатериалов

// Выполняет стандартные действия при вводе новой строки таб. части, в которой предусмотрен автовыбор номенклатуры
//  - устанавливает способ автовыбора номенклатуры
//  - устанавливает способ автовыбора характеристики
//  - копирует настройки автовыбора.
//
// Параметры:
//  ДанныеСтроки			 - ДанныеФормыСтруктура	 - содержит данные строки
//  КлючСвязиИсточника		 - Число, Неопределено	 - ключ связи источника (при копировании строки)
//  СоответствиеСвойств		 - ДанныеФормыКоллекция	 - табличная часть "СоответствиеСвойств".
//
Процедура ПриВводеНовойСтрокиСАвтовыбором(ДанныеСтроки, КлючСвязиИсточника = Неопределено, СоответствиеСвойств = Неопределено) Экспорт

	НоваяСтрока = (КлючСвязиИсточника = Неопределено);
	
	Если НоваяСтрока ИЛИ Не ЗначениеЗаполнено(ДанныеСтроки.СпособАвтовыбораНоменклатуры) Тогда
		ДанныеСтроки.СпособАвтовыбораНоменклатуры = ПредопределенноеЗначение("Перечисление.СпособыАвтовыбораНоменклатуры.УказываетсяВНСИ");
	КонецЕсли;
	
	Если НоваяСтрока ИЛИ Не ЗначениеЗаполнено(ДанныеСтроки.СпособАвтовыбораХарактеристики) Тогда
		ДанныеСтроки.СпособАвтовыбораХарактеристики = ПредопределенноеЗначение("Перечисление.СпособыАвтовыбораХарактеристики.УказываетсяВНСИ");
	КонецЕсли;
	
	Если (КлючСвязиИсточника <> Неопределено) Тогда
		СписокСтрок = СоответствиеСвойств.НайтиСтроки(Новый Структура("КлючСвязи", КлючСвязиИсточника));
		Для каждого НайденнаяСтрока Из СписокСтрок Цикл
			НоваяСтрока = СоответствиеСвойств.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, НайденнаяСтрока);
			НоваяСтрока.КлючСвязи = ДанныеСтроки.КлючСвязи;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

// Выполняет стандартные действия при вводе новой строки в таблице, в которой предусмотрена возможность отбора по свойствам
//   - копирует настройки отбора
//
// Параметры:
//  ДанныеСтроки          - ДанныеФормыСтруктура   - содержит данные строки
//  КлючСвязиИсточника    - Число, Неопределено    - ключ связи источника (при копировании строки)
//  ОтборПоСвойствам      - ДанныеФормыКоллекция   - табличная часть "ОтборПоСвойствам"
Процедура ПриВводеНовойСтрокиСОтборомПоСвойствам(ДанныеСтроки, КлючСвязиИсточника = Неопределено, ОтборПоСвойствам = Неопределено) Экспорт

	Если КлючСвязиИсточника <> Неопределено Тогда // Копирование
		
		СписокСтрок = ОтборПоСвойствам.НайтиСтроки(Новый Структура("КлючСвязи", КлючСвязиИсточника));
		Для каждого НайденнаяСтрока Из СписокСтрок Цикл
			НоваяСтрока = ОтборПоСвойствам.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, НайденнаяСтрока);
			НоваяСтрока.КлючСвязи = ДанныеСтроки.КлючСвязи;
		КонецЦикла;
		
	КонецЕсли;

КонецПроцедуры

// Выполняет стандартные действия при изменении материала
//
Процедура ПриИзмененииНоменклатурыВСтрокеСАвтовыбором(ДанныеСтроки, Объект) Экспорт

	Если ДанныеСтроки.СпособАвтовыбораНоменклатуры <> ПредопределенноеЗначение("Перечисление.СпособыАвтовыбораНоменклатуры.УказываетсяВНСИ") Тогда
		ДанныеСтроки.СпособАвтовыбораНоменклатуры = ПредопределенноеЗначение("Перечисление.СпособыАвтовыбораНоменклатуры.УказываетсяВНСИ");
		ДанныеСтроки.НоменклатураСтрокой = "";
	КонецЕсли; 
		
КонецПроцедуры

// Выполняет стандартные действия при изменении характеристики
//
Процедура ПриИзмененииХарактеристикиВСтрокеСАвтовыбором(ДанныеСтроки, Объект) Экспорт

	Если ДанныеСтроки.СпособАвтовыбораХарактеристики <> ПредопределенноеЗначение("Перечисление.СпособыАвтовыбораХарактеристики.УказываетсяВНСИ") Тогда
		ДанныеСтроки.СпособАвтовыбораХарактеристики = ПредопределенноеЗначение("Перечисление.СпособыАвтовыбораХарактеристики.УказываетсяВНСИ");
		ДанныеСтроки.ХарактеристикаСтрокой = "";
	КонецЕсли;
	
	ЗаданныеСвойства = Объект.СоответствиеСвойств.НайтиСтроки(Новый Структура("КлючСвязи", ДанныеСтроки.КлючСвязи));
	Для каждого ЭлементКоллекции Из ЗаданныеСвойства Цикл
		Объект.СоответствиеСвойств.Удалить(ЭлементКоллекции);
	КонецЦикла; 
	
КонецПроцедуры

// Функция определяет является ли материал полуфабрикатом производимым в процессе
//
// Параметры:
//  ДанныеСтроки - ДанныеФормыСтруктура - содержит данные строки.
// 
// Возвращаемое значение:
//   - Булево - Истина, если материал является полуфабрикатом и производится в процессе.
//
Функция ПолуфабрикатПроизводимыйВПроцессе(ДанныеСтроки) Экспорт
	
	
	Возврат Ложь; // пустой обработчик
	
КонецФункции

// Функция определяет является ли материал полуфабрикатом производимым в процессе на этапе.
//
// Параметры:
//  ДанныеСтроки - ДанныеФормыСтруктура - содержит данные строки.
// 
// Возвращаемое значение:
//   - Булево - Истина, если материал является полуфабрикатом и производится в процессе на этапе.
//
Функция ПолуфабрикатПроизводитсяНаЭтапе(ДанныеСтроки) Экспорт
	
	
	Возврат Ложь; // пустой обработчик
	
КонецФункции

// Функция определяет является ли материал полуфабрикатом производимым в процессе по спецификации.
//
// Параметры:
//  ДанныеСтроки - ДанныеФормыСтруктура - содержит данные строки.
// 
// Возвращаемое значение:
//   - Булево - Истина, если материал является полуфабрикатом и производится в процессе по спецификации.
//
Функция ПолуфабрикатПроизводитсяПоСпецификации(ДанныеСтроки) Экспорт
	
	
	Возврат Ложь; // пустой обработчик
	
КонецФункции

Процедура ЗаполнитьСпособПолученияМатериалаПоУмолчанию(ДанныеСтроки) Экспорт
	
	СтруктураЗначений = Новый Структура;
	
	СтруктураЗначений.Вставить("ПроизводитсяВПроцессе", Ложь);
	СтруктураЗначений.Вставить("ИсточникПолученияПолуфабриката", ПредопределенноеЗначение("Справочник.РесурсныеСпецификации.ПустаяСсылка"));
	СтруктураЗначений.Вставить("ИсточникПолученияПолуфабрикатаПредставление", "");
	СтруктураЗначений.Вставить("ПланироватьНеРанее", ПредопределенноеЗначение("Справочник.ЭтапыПроизводства.ПустаяСсылка"));
	СтруктураЗначений.Вставить("ПланироватьНеРанееПредставление", "");
	СтруктураЗначений.Вставить("СпецификацияРемонта", ПредопределенноеЗначение("Справочник.РесурсныеСпецификации.ПустаяСсылка"));
	СтруктураЗначений.Вставить("СпецификацияРемонтаПредставление", "");
	СтруктураЗначений.Вставить("СпособПолученияМатериала", ПредопределенноеЗначение("Перечисление.СпособыПолученияМатериаловВСпецификации.Обеспечивать"));
	СтруктураЗначений.Вставить("СпособПолученияМатериалаРедактирование", НСтр("ru = 'Обеспечивать'"));
	
	ЗаполнитьЗначенияСвойств(ДанныеСтроки, СтруктураЗначений);
	
КонецПроцедуры

// Возвращает массив доступных типов номенклатуры для таб.частей НСИ производства
// 
// Параметры:
//  Форма - ФормаКлиентскогоПриложения
//  ИмяТЧ - Строка - Имя ТЧ
// 
// Возвращаемое значение:
//  Массив - Массив доступных типов номенклатуры
Функция МассивДоступныхТиповНоменклатуры(Форма, ИмяТЧ = "") Экспорт
	
	Результат = Новый Массив;
	
	Результат.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.МногооборотнаяТара"));
	Результат.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.Товар"));
	Результат.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.Работа"));
	
	Если ИмяТЧ = "МатериалыИУслуги" Тогда
		
		НаборыДоступны = Форма.ИсточникСоставаНаборовВПроизводстве = ПредопределенноеЗначение("Перечисление.ИсточникиСоставаНаборовВПроизводстве.ВариантыКомплектации")
			ИЛИ Форма.ИсточникСоставаНаборовВПроизводстве = ПредопределенноеЗначение("Перечисление.ИсточникиСоставаНаборовВПроизводстве.СпецификацииИлиВариантыКомплектации");
		
		Если НаборыДоступны Тогда
			Результат.Добавить(ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.Набор"));
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Устанавливает параметры выбора материалов в производственной НСИ
// 
// Параметры:
//  Элемент - ПолеФормы
//  Форма - ФормаКлиентскогоПриложения
Процедура УстановитьПараметрыВыбораМатериалов(Элемент, Форма) Экспорт
	
	МассивТиповНоменклатуры = МассивДоступныхТиповНоменклатуры(Форма, "МатериалыИУслуги");
	
	МассивПараметровВыбора = Новый Массив;
	МассивПараметровВыбора.Добавить(Новый ПараметрВыбора("Отбор.ТипНоменклатуры", Новый ФиксированныйМассив(МассивТиповНоменклатуры)));
	
	Если ТипЗнч(Элемент) = Тип("Массив") Тогда
		Элементы = Элемент;
	Иначе
		Элементы = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Элемент);
	КонецЕсли;
	
	Для Индекс = 0 По Элементы.ВГраница() Цикл
		Элементы[Индекс].ПараметрыВыбора = Новый ФиксированныйМассив(МассивПараметровВыбора);
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти

#Область ОписаниеПроизводственногоПроцесса

// Получает данные основного изделия спецификации
//
// Параметры:
//  Объект	 - СправочникОбъект.РесурсныеСпецификации, Структура - спецификация.
// 
// Возвращаемое значение:
//  Структура - данные основного изделия.
//
Функция ДанныеОсновногоИзделияСпецификации(Объект) Экспорт
	
	ЭтоСборка   = (Объект.ТипПроизводственногоПроцесса = ПредопределенноеЗначение("Перечисление.ТипыПроизводственныхПроцессов.Сборка"));
	ЭтоРемонт   = (Объект.ТипПроизводственногоПроцесса = ПредопределенноеЗначение("Перечисление.ТипыПроизводственныхПроцессов.Ремонт"));
	ЭтоРазборка = (Объект.ТипПроизводственногоПроцесса = ПредопределенноеЗначение("Перечисление.ТипыПроизводственныхПроцессов.Разборка"));
	
	Если (ЭтоСборка ИЛИ ЭтоРемонт)
		И Объект.ВыходныеИзделия.Количество() <> 0 Тогда
		
		Результат = Новый Структура(
			"ВидНоменклатуры,
			|Номенклатура,
			|Характеристика,
			|Упаковка,
			|КоличествоУпаковок");
		ЗаполнитьЗначенияСвойств(Результат, Объект.ВыходныеИзделия[0]);
		
	ИначеЕсли ЭтоРазборка Тогда
		
		Результат = Новый Структура;
		Результат.Вставить("ВидНоменклатуры",    Объект.ОсновноеИзделиеВидНоменклатуры);
		Результат.Вставить("Номенклатура",       Объект.ОсновноеИзделиеНоменклатура);
		Результат.Вставить("Характеристика",     Объект.ОсновноеИзделиеХарактеристика);
		Результат.Вставить("Упаковка",           Объект.ОсновноеИзделиеУпаковка);
		Результат.Вставить("КоличествоУпаковок", Объект.ОсновноеИзделиеКоличествоУпаковок);
		
	Иначе
		
		Результат = Новый Структура;
		Результат.Вставить("ВидНоменклатуры",    ПредопределенноеЗначение("Справочник.ВидыНоменклатуры.ПустаяСсылка"));
		Результат.Вставить("Номенклатура",       ПредопределенноеЗначение("Справочник.Номенклатура.ПустаяСсылка"));
		Результат.Вставить("Характеристика",     ПредопределенноеЗначение("Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка"));
		Результат.Вставить("Упаковка",           ПредопределенноеЗначение("Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка"));
		Результат.Вставить("КоличествоУпаковок", 0);
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Получает значение основного реквизита по данным основного изделия спецификации
//
// Параметры:
//  Объект  - СправочникОбъект.РесурсныеСпецификации, Структура - спецификация.
//  ОсновноеИзделие - см. ДанныеОсновногоИзделияСпецификации
// 
// Возвращаемое значение:
//  Структура - данные основного реквизита
//
Функция ОсновнойРеквизитОсновногоИзделияСпецификации(Объект, ОсновноеИзделие = Неопределено) Экспорт
	
	Результат = Новый Структура;
	
	Если ОсновноеИзделие = Неопределено Тогда
		ОсновноеИзделие = ДанныеОсновногоИзделияСпецификации(Объект);
	КонецЕсли;
	
	Если Объект.ВариантНазначения = ПредопределенноеЗначение("Перечисление.ВариантыНазначенияСпецификации.ВидНоменклатуры") Тогда
		Результат.Вставить("Имя", "ВидНоменклатуры");
	Иначе
		Результат.Вставить("Имя", "Номенклатура");
	КонецЕсли;
	
	Результат.Вставить("Значение", ОсновноеИзделие[Результат.Имя]);
	
	Возврат Результат;
	
КонецФункции

// Возвращает представление единицы измерения партии выпуска
//
// Параметры:
//  ОписаниеПартииВыпуска	 - Структура, Строка, СправочникСсылка.УпаковкиЕдиницыИзмерения	 - описание или единица измерения партии выпуска
//  Количество				 - Число														 - количество единиц/партий.
// 
// Возвращаемое значение:
//  Строка - представление единицы измерения партии выпуска.
//
Функция ПредставлениеЕдиницыИзмеренияПартииВыпуска(ОписаниеПартииВыпуска = Неопределено, Количество = 0) Экспорт
	
	Если ОписаниеПартииВыпуска <> Неопределено Тогда
		
		Если ТипЗнч(ОписаниеПартииВыпуска) = Тип("ФиксированнаяСтруктура") Тогда
			ИспользуетсяОписаниеПартииВыпуска = Истина;
			ЕдиницаИзмеренияПартииВыпуска = ОписаниеПартииВыпуска.ЕдиницаИзмеренияПартииВыпуска;
		Иначе
			ИспользуетсяОписаниеПартииВыпуска = Ложь;
			ЕдиницаИзмеренияПартииВыпуска = ОписаниеПартииВыпуска;
		КонецЕсли;
		Если Не ЗначениеЗаполнено(ЕдиницаИзмеренияПартииВыпуска) Тогда
			Если ИспользуетсяОписаниеПартииВыпуска И ОписаниеПартииВыпуска.ВыпускПроизвольнымиПорциями Тогда
				Результат = НСтр("ru = 'ед. хранения'");
			Иначе
				Результат = ОбщегоНазначенияУТКлиентСервер.СклонениеСлова(
								Количество,
								НСтр("ru = 'партия'"),
								НСтр("ru = 'партии'"),
								НСтр("ru = 'партий'"),
								"ж");
			КонецЕсли;
		Иначе
			Результат = Строка(ЕдиницаИзмеренияПартииВыпуска);
		КонецЕсли;
		
		// Дополним единицу измерения описанием партии выпуска
		Если ИспользуетсяОписаниеПартииВыпуска 
			И Не ОписаниеПартииВыпуска.МножественныйВыпуск
			И Не ОписаниеПартииВыпуска.ВыпускПроизвольнымиПорциями
			И ОписаниеПартииВыпуска.ЕдиницаИзмеренияИзделия <> ОписаниеПартииВыпуска.ЕдиницаИзмеренияПартииВыпуска
			И ОписаниеПартииВыпуска.КоличествоУпаковок > 0 Тогда
				Результат = СтрШаблон(
								НСтр("ru = '%1 (%2 %3)'"),
								Результат,
								Формат(ОписаниеПартииВыпуска.КоличествоУпаковок,"ЧН=; ЧГ="), 
								ОписаниеПартииВыпуска.ЕдиницаИзмеренияИзделия
				);
		КонецЕсли;
		
		Возврат Результат;
	Иначе
		
		Возврат НСтр("ru = 'единиц/партий изделий'");
	КонецЕсли;

КонецФункции

// Устанавливает оформление для поля ввода количества единиц/партий
//
// Параметры:
//  ВыпускПроизвольнымиПорциями	 - Булево	 - Истина, если доступен выпуск произвольными порциями
//  Элемент						 - ПолеФормы - элемент управления.
//
Процедура УстановитьПараметрыВводаКоличестваЕдиницПартий(ВыпускПроизвольнымиПорциями, Элемент) Экспорт
	
	Элемент.ОграничениеТипа = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15, ?(ВыпускПроизвольнымиПорциями,3,0)));
	
	Элемент.КнопкаВыбора        = ВыпускПроизвольнымиПорциями;
	Элемент.КнопкаРегулирования = НЕ ВыпускПроизвольнымиПорциями;
	
КонецПроцедуры

#КонецОбласти

#Область Прочее

// Формирует представление этапа, которое можно использовать для вывода пользователю.
//
// Параметры:
//  СпецификацияПредставление			- Строка - Представление спецификации
//  ЭтапПредставление					- Строка - Представление этапа
//  МногоэтапныйПроизводственныйПроцесс	- Булево - Признак того что производственный процесс состоит из нескольких этапов
//  ЭтапВосстановленияБрака				- Булево - Признак того что этап создан для восстановление брака.
//
// Возвращаемое значение:
//   Строка   - представление этапа.
//
Функция ПредставлениеЭтапа(СпецификацияПредставление, ЭтапПредставление, МногоэтапныйПроизводственныйПроцесс, ЭтапВосстановленияБрака = Ложь) Экспорт

	Если МногоэтапныйПроизводственныйПроцесс Тогда
		СпецификацияСтрока = ЭтапПредставление + ", " + СпецификацияПредставление;
	Иначе
		СпецификацияСтрока = СпецификацияПредставление;
	КонецЕсли;
	Если ЭтапВосстановленияБрака Тогда
		СпецификацияСтрока = СпецификацияСтрока + " (" + НСтр("ru = 'восстановление брака'") + ")";
	КонецЕсли; 

	Возврат СпецификацияСтрока;
		
КонецФункции

// Возвращает строковое представление статуса спецификации
//
// Параметры:
//  Статус			 - ПеречислениеСсылка.СтатусыСпецификаций	 - статус спецификации
//  НачалоДействия	 - Дата										 - начало периода действия
//  КонецДействия	 - Дата										 - конец периода действия
//  СтрокаСтатус	 - Строка									 - представление.
// 
// Возвращаемое значение:
//  Строка - представление спецификации.
//
Функция ПредставлениеСтатусаСпецификации(Статус, НачалоДействия = '00010101', КонецДействия = '00010101', СтрокаСтатус = "") Экспорт
	
	Если ПустаяСтрока(СтрокаСтатус) Тогда
		СтрокаСтатус = Строка(Статус);
	КонецЕсли;
	
	СтрокаПериодДействия = "";
	Если Статус = ПредопределенноеЗначение("Перечисление.СтатусыСпецификаций.Действует") Тогда
		Если НачалоДействия <> '00010101' И КонецДействия <> '00010101' Тогда
			СтрокаПериодДействия = " " + СтрШаблон(НСтр("ru = 'с %1 по %2'"), Формат(НачалоДействия, "ДЛФ=D"), Формат(КонецДействия, "ДЛФ=D"));
		ИначеЕсли НачалоДействия <> '00010101' Тогда
			СтрокаПериодДействия = " " + СтрШаблон(НСтр("ru = 'с %1'"), Формат(НачалоДействия, "ДЛФ=D"));
		ИначеЕсли КонецДействия <> '00010101'  Тогда
			СтрокаПериодДействия = " " + СтрШаблон(НСтр("ru = 'по %1'"), Формат(КонецДействия, "ДЛФ=D"));
		КонецЕсли;
	КонецЕсли;
	
	СтрокаСтатус = СтрШаблон("%1%2", СтрокаСтатус, СтрокаПериодДействия);
	
	Возврат СтрокаСтатус;
	
КонецФункции

#КонецОбласти


#КонецОбласти

#Область СлужебныеПроцедурыИФункции


#Область Спецификации

Функция СобратьДанныеОбИзделииДляВыбораСпецификации(Объект,
	ТекущиеДанные,
	ПараметрыВыбораСпецификаций,
	Форма = Неопределено,
	ДополнительныеПараметры = Неопределено) Экспорт
	
	КлючПутейКДанным         = "";
	ИмяРеквизитаСпецификация = "Спецификация";
	ИмяРеквизитаОбъект       = "Объект";
	
	Если ТипЗнч(ДополнительныеПараметры) = Тип("Структура") Тогда
		
		Если ДополнительныеПараметры.Свойство("КлючПутейКДанным") Тогда
			КлючПутейКДанным = ДополнительныеПараметры.КлючПутейКДанным;
		КонецЕсли;
		
		Если ДополнительныеПараметры.Свойство("ИмяРеквизитаСпецификация") Тогда
			ИмяРеквизитаСпецификация = ДополнительныеПараметры.ИмяРеквизитаСпецификация;
		КонецЕсли;
		
		Если ДополнительныеПараметры.Свойство("ИмяРеквизитаОбъект") Тогда
			ИмяРеквизитаОбъект = ДополнительныеПараметры.ИмяРеквизитаОбъект;
		КонецЕсли;
		
	КонецЕсли;
	
	Результат = СтруктураДанныхОбИзделииДляВыбораСпецификации();
	
	Если НЕ ПараметрыВыбораСпецификаций.Свойство("СвязиПараметровВыбора") Тогда
		Возврат Результат;
	КонецЕсли;
	
	ПутиКДанным = Неопределено;
	Если НЕ ПустаяСтрока(КлючПутейКДанным) Тогда
		ПутиКДанным = ПараметрыВыбораСпецификаций.СвязиПараметровВыбора.Получить(СтрШаблон("%1.%2", КлючПутейКДанным, ИмяРеквизитаСпецификация));
	Иначе
		Для каждого КлючИЗначение Из ПараметрыВыбораСпецификаций.СвязиПараметровВыбора Цикл
			ПутиКДанным = КлючИЗначение.Значение;
			Прервать;
		КонецЦикла;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ПутиКДанным) Тогда
		
		Для каждого КлючИЗначение Из ПутиКДанным Цикл
			
			Если НЕ ЗначениеЗаполнено(КлючИЗначение.Значение) Тогда
				Продолжить;
			КонецЕсли;
			
			Если ТипЗнч(КлючИЗначение.Значение) = Тип("Структура") Тогда
				ПутьКДанным = КлючИЗначение.Значение.ПутьКДанным;
			Иначе
				ПутьКДанным = КлючИЗначение.Значение;
			КонецЕсли;
			
			ЧастиПути = СтрРазделить(ПутьКДанным, ".");
			ИмяПоля = ЧастиПути[ЧастиПути.ВГраница()];
			
			Если ЧастиПути.Количество() = 1 И Форма <> Неопределено Тогда
				Результат[КлючИЗначение.Ключ] = Форма[ИмяПоля];
			ИначеЕсли ЧастиПути.Количество() = 2 И ЧастиПути[0] = ИмяРеквизитаОбъект Тогда
				Результат[КлючИЗначение.Ключ] = Объект[ИмяПоля];
			Иначе
				Результат[КлючИЗначение.Ключ] = ТекущиеДанные[ИмяПоля];
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#Область ПрименениеМатериалов

// Заполняет информацию по автовыбору материала в строке табличной части
//
Процедура ЗаполнитьИнформациюПоПрименениюМатериала(Строка) Экспорт
	
	СтрокаВероятность = "";
	
	Строка.ПрименениеМатериалаРедактирование = Строка.ПрименениеМатериала + ?(НЕ ПустаяСтрока(СтрокаВероятность) И НЕ ПустаяСтрока(Строка.ПрименениеМатериала),", ","") + СтрокаВероятность;
	
КонецПроцедуры

#КонецОбласти


#Область Прочее

Функция СтруктураОписаниеПартииВыпуска() Экспорт
	
	ОписаниеПартииВыпуска = Новый Структура("
		|МножественныйВыпуск,
		|ВыпускПроизвольнымиПорциями,
		|
		|ВидНоменклатуры,
		|Номенклатура,
		|Характеристика,
		|Упаковка,
		|КоличествоУпаковок,
		|
		|ЕдиницаИзмеренияИзделия,
		|ЕдиницаИзмеренияПартииВыпуска");
	
	ОписаниеПартииВыпуска.МножественныйВыпуск = Ложь;
	ОписаниеПартииВыпуска.ВыпускПроизвольнымиПорциями = Ложь;
	
	ОписаниеПартииВыпуска.ВидНоменклатуры = ПредопределенноеЗначение("Справочник.ВидыНоменклатуры.ПустаяСсылка");
	ОписаниеПартииВыпуска.Номенклатура = ПредопределенноеЗначение("Справочник.Номенклатура.ПустаяСсылка");
	ОписаниеПартииВыпуска.Характеристика = ПредопределенноеЗначение("Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка");
	
	ОписаниеПартииВыпуска.Упаковка = ПредопределенноеЗначение("Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка");
	ОписаниеПартииВыпуска.КоличествоУпаковок = 0;
	
	ОписаниеПартииВыпуска.ЕдиницаИзмеренияИзделия = ПредопределенноеЗначение("Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка");
	ОписаниеПартииВыпуска.ЕдиницаИзмеренияПартииВыпуска = ПредопределенноеЗначение("Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка");
	
	Возврат ОписаниеПартииВыпуска;
	
КонецФункции

Функция СтруктураЭтапаСпецификации() Экспорт
	
	Результат = Новый Структура;
	
	Результат.Вставить("ПроизводствоНаСтороне", Ложь);
	
	Возврат Результат;
	
КонецФункции

Функция ОсновнаяЕдиницаВремени() Экспорт

	Возврат ПредопределенноеЗначение("Перечисление.ЕдиницыИзмеренияВремени.Минута");

КонецФункции

Функция РеквизитыНастройкаСоответствияСвойств() Экспорт
	
	Возврат "СвойствоМатериала,СвойствоПродукции,ЗначениеСвойства,АлгоритмРасчетаЗначения,СпособПодбораЗначения";
	
КонецФункции

// Конструктор описания функции конструктора формул
// 
// Параметры:
// 	ИмяФункции - Строка - имя функции модуля
// 	ИмяМодуля - Строка - имя модуля
// 	Наименование - Строка - наименование функции
// 	Идентификатор - Строка - идентификатор функции
// 	Представление - Строка - представление функции
// Возвращаемое значение:
// 	Структура - из:
// 		* ИмяФункции - Строка - имя функции модуля
// 		* ИмяМодуля - Строка - имя модуля
// 		* Наименование - Строка - наименование функции
// 		* Идентификатор - Строка - идентификатор функции
// 		* Представление - Строка - представление функции
//
Функция ПараметрыВыбораСпецификацийНаИзготовлениеСборку() Экспорт
	
	ПараметрыВыбора = ПараметрыВыбораСпецификаций();
	
	ПараметрыВыбора.ДоступныеТипы.Добавить(ПредопределенноеЗначение("Перечисление.ТипыПроизводственныхПроцессов.Сборка"));
	ПараметрыВыбора.ДоступныеСтатусы.Добавить(ПредопределенноеЗначение("Перечисление.СтатусыСпецификаций.Действует"));
	
	Возврат ПараметрыВыбора;
	
КонецФункции

// Формирует массив условий отбора по свойствам
// 
// Возвращаемое значение:
// 	Массив из Структура - из:
// 		* Идентификатор - Строка - идентификатор условия
// 		* Представление - Строка - представление условия
// 		* Сравнение - Булево - признак условия сравнения
// 		* Шаблон - Строка - шаблон условия
Функция СписокУсловийОтбораПоСвойствамНоменклатуры()
	
	Результат = Новый Массив;
	
	Реквизиты = "Идентификатор, Представление, Сравнение, Шаблон";
	
	Условие = Новый Структура(Реквизиты, "Равно",             НСтр("ru = 'Равно'"),               Ложь,   "%1 = %2");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "НеРавно",           НСтр("ru = 'Не равно'"),            Ложь,   "%1 <> %2");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "Больше",            НСтр("ru = 'Больше'"),              Истина, "%1 > %2");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "БольшеИлиРавно",    НСтр("ru = 'Больше или равно'"),    Истина, "%1 >= %2");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "Меньше",            НСтр("ru = 'Меньше'"),              Истина, "%1 < %2");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "МеньшеИлиРавно",    НСтр("ru = 'Меньше или равно'"),    Истина, "%1 <= %2");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "ВСписке",           НСтр("ru = 'В списке'"),            Ложь,   "%1 В (%2)");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "НеВСписке",         НСтр("ru = 'Не в списке'"),         Ложь,   "НЕ %1 В (%2)");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "ВИнтервале",        НСтр("ru = 'В интервале (>,<)'"),   Истина, "%1 > %2 И %1 < %3");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "ВИнтервалеВключая", НСтр("ru = 'В интервале (>=,<=)'"), Истина, "%1 >= %2 И %1 <= %3");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "Заполнено",         НСтр("ru = 'Заполнено'"),           Ложь,   "НЕ %1 В (НЕОПРЕДЕЛЕНО, ЛОЖЬ, 0)");
	Результат.Добавить(Условие);
	Условие = Новый Структура(Реквизиты, "НеЗаполнено",       НСтр("ru = 'Не заполнено'"),        Ложь,   "%1 В (НЕОПРЕДЕЛЕНО, ЛОЖЬ, 0)");
	Результат.Добавить(Условие);
	
	Возврат Результат;
	
КонецФункции

Функция СтруктураУсловийОтбораПоСвойствамНоменклатуры() Экспорт
	
	СтруктураУсловий = Новый Структура;
	
	Условия = СписокУсловийОтбораПоСвойствамНоменклатуры();
	Для каждого Условие Из Условия Цикл
		
		СвойстваУсловия = СтруктураУсловияОтбораПоСвойствамНоменклатуры(Условие);
		
		СтруктураУсловий.Вставить(Условие.Идентификатор, СвойстваУсловия);
		
	КонецЦикла;
	
	Возврат СтруктураУсловий;
	
КонецФункции

// Конструктор структуры условия отбора по свойствам
// 
// Параметры:
// 	Условие - Структура - из:
// 		* Идентификатор - Строка - идентификатор условия
// 		* Представление - Строка - представление условия
// 		* Сравнение - Булево - признак условия сравнения
// 		* Шаблон - Строка - шаблон условия
// Возвращаемое значение:
// 	Структура - из:
//		* Идентификатор - Строка - идентификатор условия
//		* Представление - Строка - представление условия
//		* Сравнение - Булево - признак условия сравнения
//		* Шаблон - Строка - шаблон условия
//		* Список - Булево - признак условия работы со списом
//		* Интервал - Булево - признак интервального условия
//		* Заполненность - Булево - признак условия приверки заполненности
//		* Включая - Булево - признак условия с включением границы
//		* Обратное - Булево - признак инверсии в условии
Функция СтруктураУсловияОтбораПоСвойствамНоменклатуры(Условие) Экспорт
	
	УсловияВключая  = СтрРазделить("Равно,ВСписке,БольшеИлиРавно,МеньшеИлиРавно,ВИнтервалеВключая", ",");
	УсловияОбратные = СтрРазделить("НеРавно,НеВСписке", ",");
	
	Результат = Новый Структура;
	
	Результат.Вставить("Идентификатор", Условие.Идентификатор);
	Результат.Вставить("Представление", Условие.Представление);
	Результат.Вставить("Сравнение",     Условие.Сравнение);
	Результат.Вставить("Шаблон",        Условие.Шаблон);
	Результат.Вставить("Список",        СтрНайти(Условие.Идентификатор, "ВСписке") > 0);
	Результат.Вставить("Интервал",      СтрНайти(Условие.Идентификатор, "ВИнтервале") > 0);
	Результат.Вставить("Заполненность", СтрНайти(Условие.Идентификатор, "Заполнено") > 0);
	Результат.Вставить("Включая",       УсловияВключая.Найти(Условие.Идентификатор) <> Неопределено);
	Результат.Вставить("Обратное",      УсловияОбратные.Найти(Условие.Идентификатор) <> Неопределено);
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#КонецОбласти